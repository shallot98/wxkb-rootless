# 微信输入法滑动切换插件 - 测试计划

## 项目信息
- **项目名称**: WeChatKeyboardSwitch
- **版本**: 1.0.0
- **目标应用**: 微信输入法 (WeType Keyboard)
- **支持系统**: iOS 13+
- **越狱类型**: Rootless Jailbreak Compatible

## 测试目标
验证微信输入法滑动切换中英文功能的正确性、稳定性和兼容性，确保插件在各种场景下都能正常工作。

## 测试范围

### 核心功能
- 上滑手势切换输入法语言
- 下滑手势切换输入法语言
- 中文到英文切换
- 英文到中文切换

### 非功能性需求
- 响应速度
- 系统稳定性
- 内存占用
- 兼容性

---

## 1. 功能测试

### TC-001: 上滑手势切换（中文→英文）
**前置条件**:
- 已安装WeChatKeyboardSwitch插件
- 微信输入法当前处于中文输入模式（拼音/五笔）
- 键盘已显示

**测试步骤**:
1. 打开任意支持文本输入的应用（如备忘录、微信聊天）
2. 点击文本输入框，调出微信输入法键盘
3. 确认当前为中文输入模式
4. 在键盘区域从下向上滑动手指
5. 观察键盘输入模式变化

**预期结果**:
- 键盘立即切换到英文输入模式（ABC）
- 键盘布局从中文键盘变为英文键盘
- 候选词区域显示英文输入提示
- 切换过程流畅，无卡顿

**验收标准**:
- [ ] 切换成功率 100%
- [ ] 响应时间 < 200ms
- [ ] 无崩溃或异常

---

### TC-002: 上滑手势切换（英文→中文）
**前置条件**:
- 已安装WeChatKeyboardSwitch插件
- 微信输入法当前处于英文输入模式（ABC）
- 键盘已显示

**测试步骤**:
1. 打开任意支持文本输入的应用
2. 点击文本输入框，调出微信输入法键盘
3. 确认当前为英文输入模式
4. 在键盘区域从下向上滑动手指
5. 观察键盘输入模式变化

**预期结果**:
- 键盘立即切换到中文输入模式（拼音/五笔）
- 键盘布局从英文键盘变为中文键盘
- 候选词区域显示中文输入提示
- 切换过程流畅，无卡顿

**验收标准**:
- [ ] 切换成功率 100%
- [ ] 响应时间 < 200ms
- [ ] 无崩溃或异常

---

### TC-003: 下滑手势切换（中文→英文）
**前置条件**:
- 已安装WeChatKeyboardSwitch插件
- 微信输入法当前处于中文输入模式
- 键盘已显示

**测试步骤**:
1. 打开任意支持文本输入的应用
2. 点击文本输入框，调出微信输入法键盘
3. 确认当前为中文输入模式
4. 在键盘区域从上向下滑动手指
5. 观察键盘输入模式变化

**预期结果**:
- 键盘立即切换到英文输入模式（ABC）
- 键盘布局从中文键盘变为英文键盘
- 候选词区域显示英文输入提示
- 切换过程流畅，无卡顿

**验收标准**:
- [ ] 切换成功率 100%
- [ ] 响应时间 < 200ms
- [ ] 无崩溃或异常

---

### TC-004: 下滑手势切换（英文→中文）
**前置条件**:
- 已安装WeChatKeyboardSwitch插件
- 微信输入法当前处于英文输入模式
- 键盘已显示

**测试步骤**:
1. 打开任意支持文本输入的应用
2. 点击文本输入框，调出微信输入法键盘
3. 确认当前为英文输入模式
4. 在键盘区域从上向下滑动手指
5. 观察键盘输入模式变化

**预期结果**:
- 键盘立即切换到中文输入模式
- 键盘布局从英文键盘变为中文键盘
- 候选词区域显示中文输入提示
- 切换过程流畅，无卡顿

**验收标准**:
- [ ] 切换成功率 100%
- [ ] 响应时间 < 200ms
- [ ] 无崩溃或异常

---

### TC-005: 连续快速滑动测试
**前置条件**:
- 已安装WeChatKeyboardSwitch插件
- 微信输入法键盘已显示

**测试步骤**:
1. 打开任意支持文本输入的应用
2. 调出微信输入法键盘
3. 连续快速执行上滑或下滑手势10次
4. 观察每次切换的响应情况
5. 检查是否有遗漏或错误切换

**预期结果**:
- 每次滑动都能正确识别
- 输入模式在中英文之间正确切换
- 无卡顿或延迟累积
- 无崩溃或异常

**验收标准**:
- [ ] 10次连续滑动全部响应
- [ ] 切换逻辑正确（中英文交替）
- [ ] 无性能下降
- [ ] 无内存泄漏

---

## 2. 兼容性测试

### TC-006: iOS 13 系统测试
**测试环境**:
- iOS 13.x 越狱设备
- 微信输入法最新版本

**测试内容**:
- 执行 TC-001 至 TC-005 所有功能测试
- 验证插件加载正常
- 验证手势识别正常
- 验证输入模式切换正常

**验收标准**:
- [ ] 所有功能测试通过
- [ ] 无系统兼容性问题
- [ ] 无崩溃或异常

---

### TC-007: iOS 14 系统测试
**测试环境**:
- iOS 14.x 越狱设备
- 微信输入法最新版本

**测试内容**:
- 执行 TC-001 至 TC-005 所有功能测试
- 验证插件加载正常
- 验证手势识别正常
- 验证输入模式切换正常

**验收标准**:
- [ ] 所有功能测试通过
- [ ] 无系统兼容性问题
- [ ] 无崩溃或异常

---

### TC-008: iOS 15 系统测试
**测试环境**:
- iOS 15.x 越狱设备
- 微信输入法最新版本

**测试内容**:
- 执行 TC-001 至 TC-005 所有功能测试
- 验证插件加载正常
- 验证手势识别正常
- 验证输入模式切换正常

**验收标准**:
- [ ] 所有功能测试通过
- [ ] 无系统兼容性问题
- [ ] 无崩溃或异常

---

### TC-009: iOS 16 系统测试
**测试环境**:
- iOS 16.x 越狱设备
- 微信输入法最新版本

**测试内容**:
- 执行 TC-001 至 TC-005 所有功能测试
- 验证插件加载正常
- 验证手势识别正常
- 验证输入模式切换正常

**验收标准**:
- [ ] 所有功能测试通过
- [ ] 无系统兼容性问题
- [ ] 无崩溃或异常

---

## 3. 稳定性测试

### TC-010: 长时间使用测试
**测试环境**:
- 越狱iOS设备（任意支持版本）
- 微信输入法

**测试步骤**:
1. 安装WeChatKeyboardSwitch插件
2. 在1小时内持续使用微信输入法进行文本输入
3. 期间多次使用滑动手势切换输入模式（至少50次）
4. 在不同应用间切换使用键盘
5. 监控系统资源占用和应用稳定性

**测试场景**:
- 微信聊天输入
- 备忘录长文本输入
- Safari浏览器搜索框输入
- 邮件应用输入
- 第三方应用输入

**监控指标**:
- 内存占用变化
- CPU使用率
- 崩溃次数
- 响应延迟
- 电池消耗

**预期结果**:
- 插件持续正常工作
- 无内存泄漏
- 无崩溃或卡顿
- 响应时间保持稳定
- 对系统性能影响最小

**验收标准**:
- [ ] 1小时内无崩溃
- [ ] 内存增长 < 5MB
- [ ] CPU占用 < 1%
- [ ] 响应时间无明显增加
- [ ] 无异常日志

---

## 4. 性能测试

### TC-011: 切换响应时间测试
**测试目标**: 测量从手势触发到输入模式切换完成的时间

**测试方法**:
1. 使用高速摄像或屏幕录制工具
2. 记录10次滑动切换操作
3. 分析每次操作的响应时间
4. 计算平均响应时间和最大响应时间

**性能指标**:
- 平均响应时间: < 200ms
- 最大响应时间: < 300ms
- 响应时间标准差: < 50ms

**验收标准**:
- [ ] 平均响应时间达标
- [ ] 最大响应时间达标
- [ ] 响应时间稳定

---

### TC-012: 内存占用测试
**测试目标**: 测量插件对系统内存的影响

**测试方法**:
1. 使用Xcode Instruments或SSH连接设备
2. 记录安装插件前后的内存占用
3. 记录使用插件过程中的内存变化
4. 分析是否存在内存泄漏

**性能指标**:
- 插件静态内存占用: < 2MB
- 运行时额外内存: < 5MB
- 无内存泄漏

**验收标准**:
- [ ] 内存占用在合理范围
- [ ] 无内存泄漏
- [ ] 对系统影响最小

---

## 测试环境准备

### 1. 硬件要求
- **iOS设备**: iPhone 或 iPad
- **越狱状态**: 已越狱（支持Rootless越狱）
- **系统版本**: iOS 13.0 或更高版本
- **存储空间**: 至少100MB可用空间

### 2. 软件要求
- **微信输入法**: 已安装最新版本的WeType Keyboard
- **包管理器**: Sileo、Cydia 或 Zebra
- **SSH工具**: （可选）用于远程安装和调试
- **日志查看工具**: （可选）Console.app 或 oslog

### 3. 测试环境配置步骤

#### 步骤1: 准备越狱设备
```bash
# 确认设备已越狱
ls /var/jb  # Rootless越狱应该存在此目录

# 确认包管理器可用
which dpkg
```

#### 步骤2: 安装微信输入法
1. 打开App Store
2. 搜索"微信输入法"或"WeType"
3. 下载并安装
4. 在系统设置中启用微信输入法
   - 设置 → 通用 → 键盘 → 键盘 → 添加新键盘 → 微信输入法

#### 步骤3: 配置SSH连接（可选）
```bash
# 在设备上安装OpenSSH
# 通过包管理器安装openssh

# 在电脑上连接设备
ssh root@<设备IP地址>
# 默认密码: alpine（建议修改）
```

#### 步骤4: 传输并安装插件
```bash
# 方法1: 使用SCP传输deb包
scp WeChatKeyboardSwitch.deb root@<设备IP>:/var/root/

# 方法2: 使用Filza文件管理器
# 通过AirDrop或其他方式传输deb包到设备

# 安装插件
ssh root@<设备IP>
dpkg -i /var/root/WeChatKeyboardSwitch.deb

# 或者通过包管理器安装
```

#### 步骤5: 重启相关进程
```bash
# 方法1: 重启SpringBoard（推荐）
killall -9 SpringBoard

# 方法2: 重启设备
reboot

# 方法3: 仅重启微信输入法进程
killall -9 WeType
```

#### 步骤6: 验证插件加载
```bash
# 查看插件是否已安装
dpkg -l | grep wechatkeyboardswitch

# 查看插件文件
ls -la /Library/MobileSubstrate/DynamicLibraries/WeChatKeyboardSwitch.*

# 查看系统日志（可选）
log stream --predicate 'process == "WeType"' --level debug
```

### 4. 测试工具准备

#### 日志收集工具
```bash
# 实时查看系统日志
log stream --predicate 'eventMessage contains "WeChatKeyboardSwitch"'

# 导出日志到文件
log show --predicate 'process == "WeType"' --last 1h > wetype_log.txt
```

#### 性能监控工具
- **Xcode Instruments**: 用于详细的性能分析
- **top命令**: 监控CPU和内存使用
- **vm_stat**: 查看虚拟内存统计

#### 截图和录屏工具
- **iOS内置截图**: 电源键 + 音量上键
- **iOS内置录屏**: 控制中心 → 屏幕录制
- **第三方工具**: QuickTime Player（通过USB连接Mac）

### 5. 测试数据准备
- 准备中文测试文本（拼音输入）
- 准备英文测试文本
- 准备混合中英文测试文本
- 准备特殊字符和标点符号

---

## 测试执行计划

### 阶段1: 功能验证（预计1小时）
- 执行 TC-001 至 TC-005
- 记录测试结果
- 截图保存测试证据

### 阶段2: 兼容性测试（预计2小时）
- 在不同iOS版本设备上执行测试
- 执行 TC-006 至 TC-009
- 记录兼容性问题

### 阶段3: 稳定性测试（预计2小时）
- 执行 TC-010 长时间使用测试
- 监控系统资源
- 记录异常情况

### 阶段4: 性能测试（预计1小时）
- 执行 TC-011 和 TC-012
- 收集性能数据
- 分析性能瓶颈

### 阶段5: 回归测试（预计30分钟）
- 修复问题后重新测试
- 验证修复效果
- 确保无新问题引入

---

## 测试交付物

### 必需文档
1. **TEST_REPORT.md**: 详细的测试报告
2. **测试截图**: 每个测试用例的截图证据
3. **日志文件**: 测试过程中的系统日志
4. **性能数据**: 性能测试的原始数据

### 可选文档
1. **问题跟踪表**: 发现的bug和问题列表
2. **改进建议**: 功能优化和改进建议
3. **用户手册**: 插件使用说明

---

## 风险评估

### 高风险项
- **微信输入法版本更新**: 可能导致接口变化，插件失效
- **iOS系统更新**: 新版本iOS可能改变键盘机制
- **越狱环境差异**: 不同越狱工具可能有兼容性问题

### 中风险项
- **其他插件冲突**: 与其他键盘相关插件可能冲突
- **手势识别冲突**: 与原有手势功能可能冲突
- **性能影响**: 可能影响键盘响应速度

### 低风险项
- **内存泄漏**: 长时间使用可能导致内存增长
- **特殊场景**: 某些特殊应用可能不兼容

---

## 测试成功标准

### 必须满足的条件
- [ ] 所有功能测试用例（TC-001至TC-005）通过率 100%
- [ ] 至少在一个iOS版本上完成完整测试
- [ ] 无严重崩溃或数据丢失问题
- [ ] 响应时间符合性能指标
- [ ] 无明显的内存泄漏

### 建议满足的条件
- [ ] 在多个iOS版本上测试通过
- [ ] 长时间稳定性测试通过
- [ ] 性能测试达标
- [ ] 与常见应用兼容性良好
- [ ] 用户体验流畅

---

## 附录

### A. 常见问题排查

#### 问题1: 插件未生效
**排查步骤**:
1. 确认插件已正确安装: `dpkg -l | grep wechatkeyboardswitch`
2. 确认插件文件存在: `ls /Library/MobileSubstrate/DynamicLibraries/`
3. 检查plist配置是否正确
4. 重启SpringBoard或设备
5. 查看系统日志是否有错误信息

#### 问题2: 手势不响应
**排查步骤**:
1. 确认微信输入法已启用
2. 确认在键盘区域滑动（不是候选词区域）
3. 检查滑动速度和距离是否足够
4. 查看日志确认手势是否被识别

#### 问题3: 切换后键盘异常
**排查步骤**:
1. 检查输入模式是否正确切换
2. 尝试手动切换输入法对比
3. 查看系统日志错误信息
4. 卸载插件测试原生功能是否正常

### B. 测试用例模板

```markdown
### TC-XXX: [测试用例名称]
**前置条件**:
- 条件1
- 条件2

**测试步骤**:
1. 步骤1
2. 步骤2
3. 步骤3

**预期结果**:
- 结果1
- 结果2

**验收标准**:
- [ ] 标准1
- [ ] 标准2

**实际结果**: [待填写]
**测试状态**: [ ] PASS / [ ] FAIL
**测试人员**: [待填写]
**测试日期**: [待填写]
**备注**: [待填写]
```

### C. 参考资料
- Theos开发文档: https://theos.dev
- iOS越狱开发指南
- Objective-C Runtime编程指南
- 微信输入法官方文档

---

**文档版本**: 1.0
**创建日期**: 2025-12-13
**最后更新**: 2025-12-13
**维护人员**: Development Team
